<!DOCTYPE html>
<html ng-app="codeBreaker">
    <head>
        <title>Code Breaker</title>
        <style>
            #game-board {
                margin: 1em auto 1em auto;
                padding: 2em;
                border: 2px solid black;
                max-width: 800px;
            }
            .current-turn {
                margin-bottom: 2em;
            }
            .peg-row {
                margin: 0 auto;
                text-align: center;
            }
            .game-peg {
                width: 80px;
                height: 80px;
                border: 2px solid black;
                border-radius: 1em;
                display: inline-block;
            }
            .past-guess {
                padding-top: 2em;
                border-top: 2px dotted black;
                margin: 0 20% 0 20%;
            }
            #submit {
                background-color: red;
                width: 80px;
                height: 80px;
                border: 2px solid black;
                border-radius: 1em;
                text-align: center;
                margin: 0 auto;
                
            }
            .all-right, .part-right, .empty-right {
                width: 10px;
                height: 10px;
                border: 2px solid black;
                border-radius: 1em;
                text-align: center;
                margin: 0 auto;
            }
            .all-right {
                background-color: green;
            }
            .part-right {
                background-color: blue;
            }
            .empty-right {
                background-color: white;
            }
            .guess-answer {
                text-align: center;
            }
        </style>
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.23/angular.min.js"></script>
        <script>
            angular.module('codeBreaker', [])
            .controller('CodeBreakerController', ['$scope', function($scope) {
                    $scope.colors = ["#8080B3","#499273","#D4A76A","#803315"];
                    $scope.sizeOfRow = 4;
                    $scope.currentTurn = [];
                    $scope.pegAnswer = [];
                    $scope.initializeCurrentTurn = function() {
                        for (i = 0; i < $scope.sizeOfRow; i++) {
                            $scope.currentTurn[i] = 0;
                        }
                    }
                    $scope.pastTurns = [];
                    $scope.cycle = function(color, pegNum) {
                        if (color < $scope.colors.length - 1) {
                            color++;
                            $scope.currentTurn[pegNum] = color; 
                        } else {
                            $scope.currentTurn[pegNum] = 0;
                        }
                    }
                    $scope.submit = function() {
                        toBePushed = $scope.currentTurn.slice(0);
                        $scope.pastTurns.unshift(toBePushed);
                    }
                    $scope.calcAnswer = function() {
                        for (i = 0; i < $scope.sizeOfRow; i++) {
                            $scope.pegAnswer[i] = Math.floor(Math.random()*$scope.colors.length);
                        }
                    }
                    $scope.initializeGame = function() {
                        $scope.initializeCurrentTurn();
                        $scope.calcAnswer();
                    }
                    $scope.checkAnswer = function(guess) {
                        var turnChecker = guess.slice(0);
                        var answerChecker = $scope.pegAnswer.slice(0); 
                        var countLeft = turnChecker.length;
                        var answerString = "";
                        numAllRight = 0;
                        numPartRight = 0;
                        for (i = 0; i < countLeft; i++) {
                            if (turnChecker[i] == answerChecker[i]) {
                                numAllRight++;
                            }
                        }
                        for (i = 0; i < countLeft; i++) {
                            if (turnChecker.indexOf(answerChecker[i]) != -1 && turnChecker[i] != answerChecker[i]) {
                                numPartRight++;
                            }
                        }
                        if (numAllRight == 4) {
                            alert("You won the game!");
                        } else {
                            for (i = 0; i < numAllRight; i++) {
                                answerString += "X";
                            }
                            for (i = 0; i < numPartRight; i++) {
                                answerString += "-";
                            }
                            for (i = numAllRight + numPartRight; i < $scope.sizeOfRow; i ++) {
                                answerString += "O";
                            }
                        }
                        return answerString;
                    }
                    
                    
                    }]);
        </script>
    </head>
    <body>
        <div ng-app="codeBreaker" ng-init="initializeGame()" ng-controller="CodeBreakerController" id="game-board">
            <div id="submit" ng-click="submit()"></div>
            <div class="peg-row" style="display: none;">
                <div ng-repeat="peg in pegAnswer track by $index" class="game-peg" style="background-color: {{colors[peg]}}"></div>
            </div>
            <div class="peg-row current-turn">
                <div ng-repeat="peg in currentTurn track by $index" ng-click="cycle(peg, $index)" class="game-peg current-turn" style="background-color: {{colors[peg]}}"></div> 
            </div>
            <div ng-repeat="guess in pastTurns track by $index" class="peg-row past-guess">
                <div ng-repeat="peg in guess track by $index" class="game-peg" style="background-color: {{colors[peg]}}"></div>
                <div class="guess-answer">{{checkAnswer(guess)}}</div> 
            </div>

        </div>
    </body>
</html>
